// ----------------------------------------------------------
// This Source Code Form is subject to the terms of the
// Mozilla Public License, v.2.0. If a copy of the MPL
// was not distributed with this file, You can obtain one
// at http://mozilla.org/MPL/2.0/.
// ----------------------------------------------------------
// Codebase: https://github.com/ArKuznetsov/yabr.os/
// ----------------------------------------------------------

#Использовать "../src"
#Использовать asserts
#Использовать fs
#Использовать tempfiles

Перем ЮнитТест;
Перем ВременныйКаталог;

Перем Лог;

// Процедура выполняется после запуска теста
//
Процедура ПередЗапускомТеста() Экспорт
	
	Лог = ПараметрыПриложения.Лог();
	Лог.УстановитьУровень(УровниЛога.Информация);

КонецПроцедуры // ПередЗапускомТеста()

// Функция возвращает список тестов для выполнения
//
// Параметры:
//    Тестирование    - Тестер        - Объект Тестер (1testrunner)
//    
// Возвращаемое значение:
//    Массив        - Массив имен процедур-тестов
//    
Функция ПолучитьСписокТестов(Тестирование) Экспорт
	
	ЮнитТест = Тестирование;
	
	СписокТестов = Новый Массив;
	СписокТестов.Добавить("ТестДолжен_СписокПриложенийСВерсиямиССайта1С");
	СписокТестов.Добавить("ТестДолжен_ЗагрузитьВерсииПриложения");
	СписокТестов.Добавить("ТестДолжен_РаспаковатьВерсииПриложения");

	Возврат СписокТестов;
	
КонецФункции // ПолучитьСписокТестов()

// Процедура выполняется после запуска теста
//
Процедура ПослеЗапускаТеста() Экспорт

КонецПроцедуры // ПослеЗапускаТеста()

// Процедура - тест
//
Процедура ТестДолжен_СписокПриложенийСВерсиямиССайта1С() Экспорт
	
	Пользователь = ПолучитьПеременнуюСреды("YARD_RELEASES_USER");
	Пароль = ПолучитьПеременнуюСреды("YARD_RELEASES_PWD");

	Лог.Информация(Пользователь);

	ПараметрыОбработки = Новый Структура();
	ПараметрыОбработки.Вставить("ИмяПользователя", Пользователь);
	
	ПараметрыОбработки.Вставить("ПарольПользователя", Пароль);
	ПараметрыОбработки.Вставить("ФильтрПриложений", "Библиотека стандартных подсистем.*3\.1");
	ПараметрыОбработки.Вставить("ФильтрВерсий", "3\.1\.3.*");
	// ПараметрыОбработки.Вставить("ФильтрВерсийНачинаяСДаты");
	// ПараметрыОбработки.Вставить("ФильтрВерсийДоДаты");
	// ПараметрыОбработки.Вставить("ПутьКФайлуДляСохранения");

	СписокРелизов = Новый СписокРелизов1С();
	СписокРелизов.УстановитьПараметрыОбработкиДанных(ПараметрыОбработки);
	СписокРелизов.ОбработатьДанные();

	Утверждения.ПроверитьБольшеИлиРавно(СписокРелизов.РезультатОбработки().Количество(),
	                                    1,
	                                    "Не удалось получить список релизов.");
	
КонецПроцедуры // ТестДолжен_СписокПриложенийСВерсиямиССайта1С()

// Процедура - тест
//
// Процедура ТестДолжен_ЗагрузитьВерсииПриложения() Экспорт
// КонецПроцедуры // ТестДолжен_ЗагрузитьВерсииПриложения()

// Процедура - тест
//
// Процедура ТестДолжен_РаспаковатьВерсииПриложения() Экспорт
// КонецПроцедуры // ТестДолжен_РаспаковатьВерсииПриложения()
